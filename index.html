<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sasha Innoworks — Live Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#061026; --panel:#0e2033; --muted:#9fc0d9; --text:#eaf7ff;
  --sub:#cfeaf9; --accent:#2fb8ff; --accent-2:#6ecbff; --amber:#f1a63c;
  --radius:14px;
}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;background:linear-gradient(180deg,#031021 0%,var(--bg) 100%);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
.wrap{max-width:1180px;margin:18px auto;padding:16px;display:grid;gap:14px}
header.top{display:flex;align-items:center;gap:14px;padding:12px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));border:1px solid rgba(47,184,255,0.06)}
.logo{width:60px;height:60px;border-radius:10px;background:linear-gradient(90deg,var(--amber),#d68a2a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#081214}
.title{font-size:28px;font-weight:800;margin:0}
.company{font-size:12px;color:var(--sub);margin-top:4px}
.layout{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:8px}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));padding:12px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.02)}
.feed-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.feed-area{height:360px;border-radius:12px;border:2px solid rgba(255,255,255,0.03);position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden}
.camera{position:absolute;right:16px;top:12px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03);color:var(--sub);font-weight:700}
.track{position:absolute;left:18px;right:18px;bottom:30px;height:60px;border-radius:999px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));display:flex;align-items:center;justify-content:space-around;padding:8px 24px;border:1px solid rgba(255,255,255,0.02)}
.wheel{width:26px;height:26px;border-radius:50%;background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(255,255,255,0.02))}
.bottle-strip{display:flex;gap:44px;align-items:flex-end;will-change:transform}
.bottle-box{width:72px;height:160px;display:flex;align-items:flex-end;justify-content:center}
.small{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:10px;color:var(--sub);cursor:pointer}
.controls{display:flex;align-items:center;justify-content:space-between;margin-top:12px}
.flow{display:flex;gap:10px;align-items:center;color:var(--sub);font-weight:700}
.dot{width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
.dot.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));box-shadow:0 8px 22px rgba(47,184,255,0.08)}
.metrics{display:flex;flex-direction:column;gap:12px}
.metric-card{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
.metric-title{font-weight:800;color:var(--sub);margin-bottom:6px}
.big-val{font-size:26px;font-weight:800}
.progress{height:12px;border-radius:999px;background:rgba(255,255,255,0.03);overflow:hidden}
.progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width 600ms ease}
.events{max-height:170px;overflow:auto;margin-top:8px}
.events li{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.02);color:var(--sub)}
.bottom{margin-top:12px;display:grid;grid-template-columns:1fr 420px;gap:16px}
table{width:100%;border-collapse:collapse}
thead th{color:var(--sub);font-weight:800;text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
tbody td{padding:12px 8px;border-bottom:1px solid rgba(255,255,255,0.02);color:var(--text)}
.graph-panel{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
.canvas{width:100%;height:180px;display:block}
.bottle-selected{outline:3px solid rgba(47,184,255,0.12);border-radius:12px;padding:4px}
@media (max-width:980px){.layout{grid-template-columns:1fr}.bottom{grid-template-columns:1fr}.metrics{order:2}}
/* small helper: amber fill variable for easy change */
.liquid-amber { fill: var(--amber); opacity: 0.95; }
.liquid-cyan { fill: var(--accent); opacity: 0.95; }
</style>
</head>
<body>
<div class="wrap">
  <header class="top">
    <!-- if you upload logo.png to repo root, it will be used here automatically -->
    <img id="logoImg" src="logo.png" alt="logo" onerror="applyPlaceholderLogo()" style="width:60px;height:60px;border-radius:10px;object-fit:cover;border:3px solid rgba(0,0,0,0.06)">
    <div>
      <div class="title">Dashboard</div>
      <div class="company">Sasha Innoworks</div>
    </div>
    <div style="margin-left:auto;display:flex;gap:12px;align-items:center">
      <div style="color:var(--sub);font-weight:700">Operator: <span style="color:var(--text)">Operator 1</span></div>
      <button class="small">Profile</button>
    </div>
  </header>

  <div class="layout">
    <!-- left -->
    <section class="panel">
      <div class="feed-top">
        <div style="font-weight:800;font-size:18px">Conveyor Feed</div>
        <div style="color:var(--sub)">Status: <strong id="statusText" style="color:var(--accent)">Running</strong></div>
      </div>

      <div class="feed-area" id="feedArea">
        <div class="camera">CAM</div>
        <div style="width:92%;max-width:880px;position:relative">
          <div class="bottle-strip" id="bottleStrip" aria-hidden="true">
            <!-- SVG bottles; data-bid is the logical bottle id (0..N-1); we duplicate to make continuous strip -->
            <!-- Example uses amber fill; change class to 'liquid-cyan' to use cyan -->
            <div class="bottle-box"><svg class="bottle-svg" data-bid="0" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3"/>
              <rect class="liquid-rect liquid-amber" x="16" y="72" rx="8" width="40" height="68"></rect>
            </svg></div>

            <div class="bottle-box"><svg class="bottle-svg" data-bid="1" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3" stroke-dasharray="6 6"/>
              <rect class="liquid-rect liquid-amber" x="16" y="92" rx="8" width="40" height="48"></rect>
            </svg></div>

            <div class="bottle-box"><svg class="bottle-svg" data-bid="2" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3"/>
              <rect class="liquid-rect liquid-amber" x="16" y="64" rx="8" width="40" height="96"></rect>
            </svg></div>

            <div class="bottle-box"><svg class="bottle-svg" data-bid="3" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3"/>
              <rect class="liquid-rect liquid-amber" x="16" y="98" rx="8" width="40" height="40"></rect>
            </svg></div>

            <!-- duplicates -->
            <div class="bottle-box"><svg class="bottle-svg" data-bid="0" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3"/>
              <rect class="liquid-rect liquid-amber" x="16" y="68" rx="8" width="40" height="88"></rect>
            </svg></div>
            <div class="bottle-box"><svg class="bottle-svg" data-bid="1" viewBox="0 0 72 160" width="72" height="160">
              <path d="M26 0h20a6 6 0 0 1 6 6v16a10 10 0 0 1 10 10v110a12 12 0 0 1-12 12H22a12 12 0 0 1-12-12V32a10 10 0 0 1 10-10V6a6 6 0 0 1 6-6z" fill="none" stroke="#eaf7ff" stroke-width="3"/>
              <rect class="liquid-rect liquid-amber" x="16" y="86" rx="8" width="40" height="60"></rect>
            </svg></div>
          </div>

          <div class="track" aria-hidden="true">
            <div class="wheel"></div><div class="wheel"></div><div class="wheel"></div><div class="wheel"></div>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="flow">
          <div style="font-weight:800">Flow Speed</div>
          <div style="display:flex;gap:8px;margin-left:8px">
            <div class="dot" data-speed="1"></div>
            <div class="dot active" data-speed="2"></div>
            <div class="dot" data-speed="3"></div>
            <div class="dot" data-speed="4"></div>
          </div>
        </div>
        <div class="actions">
          <button class="small" id="pauseBtn">Pause</button>
          <button class="small" id="resumeBtn">Resume</button>
          <button class="small" id="stopBtn">Stop</button>
        </div>
      </div>
    </section>

    <!-- right -->
    <aside class="metrics">
      <div class="metric-card">
        <div class="metric-title">Liquid Level (selected)</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="big-val" id="selVal">—%</div>
          <div style="font-size:12px;color:var(--sub)" id="selLabel">Bottle —</div>
        </div>
        <div style="height:10px;margin-top:8px" class="progress"><i id="selBar" style="width:0%"></i></div>
      </div>

      <div class="metric-card">
        <div class="metric-title">Text Detection</div>
        <div style="margin-top:6px;color:var(--text);font-weight:700" id="detectedLabel">BEVARAGE</div>
        <div style="color:var(--sub);margin-top:6px">MFG: <span id="mfg">2024-04-24</span> • Exp: <span id="exp">2025-04-24</span></div>
      </div>

      <div class="metric-card">
        <div class="metric-title">Event Log</div>
        <ul class="events" id="events">
          <li>10 — Underfill bottle detected</li>
          <li>142 — Label: BEVERAGE</li>
          <li>23 — Conveyor resumed</li>
        </ul>
      </div>

      <div class="metric-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="metric-title">Real-time Liquid Graph</div><div style="color:var(--sub);font-size:12px">Last 60</div>
        </div>
        <div style="margin-top:8px">
          <canvas id="liveGraph" class="canvas"></canvas>
        </div>
      </div>
    </aside>
  </div>

  <div class="bottom">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:800">Production Summary</div>
        <div style="color:var(--sub);font-size:13px">Recent</div>
      </div>
      <table>
        <thead><tr><th>Time</th><th>Status</th><th>Fill %</th><th>Label</th><th>Dimensions</th></tr></thead>
        <tbody id="summaryTable">
          <tr><td>10:42:31</td><td style="color:#6be58b">OK</td><td>98%</td><td>Identified</td><td>10x12</td></tr>
          <tr><td>10:42:30</td><td style="color:#ff6b6b">Underfilled</td><td>55%</td><td>Not Identified</td><td>10x11</td></tr>
        </tbody>
      </table>
    </div>

    <div class="graph-panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:800">Overall Liquid Trend</div><div style="color:var(--sub);font-size:12px">Combined</div>
      </div>
      <canvas id="overallGraph" class="canvas"></canvas>
    </div>
  </div>
</div>

<script>
/* ---------------- CONFIG ----------------
If you want the UI to fetch real data from your Flask backend,
set BACKEND_URL to your server address (no trailing slash), e.g.
const BACKEND_URL = "https://myapp.onrender.com"
If BACKEND_URL is empty ("") or null the page uses mock/simulated data.
----------------------------------------- */
const BACKEND_URL = ""; // <-- set to your backend URL to enable live mode

/* helper */
function applyPlaceholderLogo(){
  const img = document.getElementById('logoImg');
  img.src = ""; // fallback blank
  img.style.background = "linear-gradient(90deg,var(--amber), #d68a2a)";
  img.style.display = "inline-block";
  img.alt = "Sasha Innoworks";
  img.style.border = "3px solid rgba(0,0,0,0.06)";
  img.style.objectFit = "cover";
}

/* UI refs */
const bottleStrip = document.getElementById('bottleStrip');
const dots = document.querySelectorAll('.dot');
const pauseBtn = document.getElementById('pauseBtn');
const resumeBtn = document.getElementById('resumeBtn');
const stopBtn = document.getElementById('stopBtn');
const selVal = document.getElementById('selVal');
const selBar = document.getElementById('selBar');
const selLabel = document.getElementById('selLabel');
const liveCanvas = document.getElementById('liveGraph');
const overallCanvas = document.getElementById('overallGraph');
const eventsEl = document.getElementById('events');
const summaryTable = document.getElementById('summaryTable');

let paused = false;
let speed = 0.8;
let offset = 0;

/* Simulated data structures (used in mock mode OR as fallback) */
let bottles = []; // will be array of {id, level, history[]}
const NUM_BOTTLES = 4;  // logical unique bottles (we duplicate SVGs for continuity)
for(let i=0;i<NUM_BOTTLES;i++){
  const lvl = Math.round(40 + Math.random()*50);
  const history = [];
  for(let j=0;j<30;j++) history.push(Math.max(8, Math.min(98, lvl + Math.round((Math.random()-0.5)*8))));
  bottles.push({id:i, level:lvl, history});
}
let selected = 0;

/* find all unique bottle svg elements and attach clicks */
document.querySelectorAll('.bottle-svg').forEach(svg=>{
  svg.addEventListener('click', ()=> {
    const bid = Number(svg.getAttribute('data-bid')) % NUM_BOTTLES;
    selectBottle(bid);
  });
});
function selectBottle(bid){
  selected = bid;
  selLabel.textContent = 'Bottle ' + (bid+1);
  // highlight selection (any bottle-box where data-bid % NUM_BOTTLES == bid)
  document.querySelectorAll('.bottle-box').forEach((box, idx)=>{
    box.classList.toggle('bottle-selected', (idx % NUM_BOTTLES) === bid);
  });
  updateSelectedUI();
}

/* update single selected UI */
function updateSelectedUI(){
  const b = bottles[selected];
  selVal.textContent = b.level + '%';
  selBar.style.width = b.level + '%';
}

/* animate the strip */
function animateStrip(){
  if(!paused){
    offset -= speed;
    // reset when beyond half width for smooth wrap
    const w = bottleStrip.scrollWidth;
    if(Math.abs(offset) > w/2) offset = 0;
    bottleStrip.style.transform = `translateX(${offset}px)`;
  }
  requestAnimationFrame(animateStrip);
}
animateStrip();

/* flow dot control */
dots.forEach((d, idx) => {
  d.addEventListener('click', ()=>{
    dots.forEach(x=>x.classList.remove('active'));
    d.classList.add('active');
    speed = 0.5 + idx*0.8;
  });
});

/* control buttons */
pauseBtn.addEventListener('click', ()=> paused = true);
resumeBtn.addEventListener('click', ()=> paused = false);
stopBtn.addEventListener('click', ()=> { paused = true; offset = 0; });

/* Graph drawing helpers */
function fitCanvas(canvas){
  const rect = canvas.getBoundingClientRect();
  const ratio = window.devicePixelRatio || 1;
  canvas.width = Math.floor(rect.width * ratio);
  canvas.height = Math.floor(rect.height * ratio);
  const ctx = canvas.getContext('2d');
  ctx.setTransform(ratio,0,0,ratio,0,0);
  return ctx;
}
const liveCtx = fitCanvas(liveCanvas);
const overallCtx = fitCanvas(overallCanvas);
window.addEventListener('resize', ()=> { fitCanvas(liveCanvas); fitCanvas(overallCanvas); drawAll(); });

/* draw live graph (selected bottle) */
function drawLive(){
  const ctx = liveCtx;
  const cw = liveCanvas.clientWidth;
  const ch = liveCanvas.clientHeight;
  ctx.clearRect(0,0,cw,ch);
  ctx.fillStyle = 'rgba(255,255,255,0.01)'; ctx.fillRect(0,0,cw,ch);

  const arr = bottles[selected].history.slice(-60);
  if(arr.length < 2) return;
  const margin = 8;
  const plotW = cw - margin*2;
  const plotH = ch - margin*2;
  const step = plotW / (Math.max(arr.length-1,1));

  // area
  const g = ctx.createLinearGradient(0,0,0,ch); g.addColorStop(0,'rgba(241,166,60,0.16)'); g.addColorStop(1,'rgba(241,166,60,0.02)');
  ctx.beginPath();
  for(let i=0;i<arr.length;i++){
    const x = margin + i*step;
    const y = margin + (1 - arr[i]/100) * plotH;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.lineTo(margin + (arr.length-1)*step, margin+plotH); ctx.lineTo(margin, margin+plotH); ctx.closePath();
  ctx.fillStyle = g; ctx.fill();

  // line
  ctx.beginPath(); for(let i=0;i<arr.length;i++){ const x=margin+i*step; const y=margin+(1-arr[i]/100)*plotH; if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}
  ctx.strokeStyle = 'rgba(241,166,60,0.95)'; ctx.lineWidth = 2.2; ctx.stroke();

  // dot last
  const lastX = margin + (arr.length-1)*step; const lastY = margin + (1-arr[arr.length-1]/100)*plotH;
  ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.95)'; ctx.arc(lastX,lastY,3,0,Math.PI*2); ctx.fill();
}

/* draw overall combined graph (average of bottles) */
function drawOverall(){
  const ctx = overallCtx;
  const cw = overallCanvas.clientWidth;
  const ch = overallCanvas.clientHeight;
  ctx.clearRect(0,0,cw,ch);
  ctx.fillStyle = 'rgba(255,255,255,0.01)'; ctx.fillRect(0,0,cw,ch);

  // compute combined history
  const len = Math.max(...bottles.map(b => b.history.length));
  const arr = [];
  for(let i=0;i<len;i++){
    let sum=0,count=0;
    bottles.forEach(b=>{ const v = b.history[b.history.length - len + i]; if(typeof v==='number'){ sum+=v; count++; }});
    if(count) arr.push(Math.round(sum/count));
  }
  if(arr.length < 2) return;
  const margin = 10; const plotW = cw - margin*2; const plotH = ch - margin*2; const step = plotW / (Math.max(arr.length-1,1));

  const g = ctx.createLinearGradient(0,0,0,ch); g.addColorStop(0,'rgba(47,184,255,0.12)'); g.addColorStop(1,'rgba(47,184,255,0.02)');
  ctx.beginPath(); for(let i=0;i<arr.length;i++){ const x=margin+i*step; const y=margin+(1-arr[i]/100)*plotH; if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);} 
  ctx.lineTo(margin+(arr.length-1)*step, margin+plotH); ctx.lineTo(margin,margin+plotH); ctx.closePath(); ctx.fillStyle=g; ctx.fill();

  ctx.beginPath(); for(let i=0;i<arr.length;i++){ const x=margin+i*step; const y=margin+(1-arr[i]/100)*plotH; if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);} 
  ctx.strokeStyle='rgba(47,184,255,0.98)'; ctx.lineWidth=2.2; ctx.stroke();
}

/* draw both graphs */
function drawAll(){ drawLive(); drawOverall(); }

/* update svg liquid rects to match bottle.level */
function refreshBottleSVGs(){
  for(let b of bottles){
    const maxH = 96;
    const h = Math.round(maxH * (b.level / 100));
    const y = 160 - 12 - h;
    // update all svg elements with matching data-bid
    document.querySelectorAll(`.bottle-svg[data-bid="${b.id}"]`).forEach(svg=>{
      const rect = svg.querySelector('.liquid-rect');
      if(rect){ rect.setAttribute('height', h); rect.setAttribute('y', y); }
    });
  }
}

/* ---- MOCK update function (if BACKEND_URL empty) ---- */
async function fetchAndUpdateMock(){
  // small noise + push history
  bottles.forEach((b, idx)=>{
    const change = Math.round((Math.random()-0.5)*6 + Math.sin(Date.now()/7000 + idx)); 
    b.level = Math.max(6, Math.min(98, b.level + change));
    b.history.push(b.level); if(b.history.length > 60) b.history.shift();
  });
  refreshBottleSVGs(); updateSelectedUI(); drawAll();
}

/* ---- LIVE fetch function (calls backend) ----
Backend expected response JSON format:
{
  "bottles": [{"id":0,"level":72,"history":[...]} , ...],
  "events":[{"time":"10:42:31","text":"Underfill"}],
  "production_summary":[{"time":"10:42:31","status":"OK","fill":98,...}, ...]
}
If your backend returns a slightly different shape adjust parsing below.
---- */
async function fetchAndUpdateLive(){
  try{
    const res = await fetch(BACKEND_URL + "/api/metrics");
    if(!res.ok) throw new Error("bad response");
    const data = await res.json();
    // parse bottles
    if(Array.isArray(data.bottles)){
      // map by id
      bottles = data.bottles.map(b => ({ id: b.id, level: b.level, history: b.history || [b.level] }));
    }
    // update events
    if(Array.isArray(data.events)){
      const evEl = document.getElementById('events');
      evEl.innerHTML = "";
      data.events.slice(0,12).forEach(e => {
        const li = document.createElement('li'); li.textContent = `${e.time || ""}  ${e.text || ""}`; evEl.appendChild(li);
      });
    }
    // summary
    if(Array.isArray(data.production_summary)){
      const tb = document.getElementById('summaryTable');
      tb.innerHTML = ""; 
      data.production_summary.slice(0,10).forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${row.time}</td><td style="color:${row.status==='OK'?'#6be58b':'#ff6b6b'}">${row.status}</td><td>${row.fill}%</td><td>${row.label}</td><td>${row.dimensions}</td>`;
        tb.appendChild(tr);
      });
    }
    // apply to SVGs
    refreshBottleSVGs();
    updateSelectedUI();
    drawAll();
  }catch(err){
    // fallback to mock updates if backend unreachable
    console.warn("fetch live failed, using mock:", err);
    await fetchAndUpdateMock();
  }
}

/* set interval to update either mock or live */
setInterval(async ()=>{
  if(BACKEND_URL) await fetchAndUpdateLive(); else await fetchAndUpdateMock();
}, 1800);
/* run once immediately */
if(BACKEND_URL) fetchAndUpdateLive(); else fetchAndUpdateMock();

/* selection update */
function updateSelectedUI(){
  const b = bottles[selected] || {level:0, history:[]};
  selVal.textContent = b.level + '%';
  selBar.style.width = b.level + '%';
  drawAll();
}
selectBottle(0); // set initial selection

/* initial draw */
drawAll();

</script>
</body>
</html>
